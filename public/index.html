<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TAKA ALLIANCE — GoldRain Master Edition</title>
<style>
body {
  margin: 0;
  background: radial-gradient(circle at center, #0a0a0a, #000);
  color: gold;
  font-family: "Poppins", sans-serif;
  overflow: hidden;
  user-select: none;
}
h1 {
  text-align: center;
  color: gold;
  text-shadow: 0 0 20px gold;
}
#loginBox, #dashboard { display: none; }
button {
  background: rgba(255,215,0,0.1);
  border: 1px solid gold;
  color: gold;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}
button:hover { background: rgba(255,215,0,0.3); }
#plannerFrame {
  width: 95%;
  height: 80vh;
  margin: 20px auto;
  border: 1px solid gold;
  display: block;
}
</style>
</head>
<body>
<h1>TAKA ALLIANCE — GoldRain Master Edition</h1>

<div id="loginBox" style="text-align:center;margin-top:100px;">
  <h2>Login Access</h2>
  <input id="username" placeholder="Username"><br><br>
  <input id="password" placeholder="Password" type="password"><br><br>
  <button onclick="checkLogin()">Login</button>
  <p id="loginStatus"></p>
</div>

<div id="dashboard" style="text-align:center;">
  <h2>Platform Selection</h2>
  <div>
    <button onclick="loadEncryptedPlanner('instagram')">Instagram</button>
    <button onclick="loadEncryptedPlanner('linkedin')">LinkedIn</button>
    <button onclick="loadEncryptedPlanner('tiktok')">TikTok</button>
    <button onclick="loadEncryptedPlanner('threads')">Threads</button>
    <button onclick="loadEncryptedPlanner('reddit')">Reddit</button>
    <button onclick="loadEncryptedPlanner('medium')">Medium</button>
    <button onclick="loadEncryptedPlanner('x')">X (Twitter)</button>
    <button onclick="loadEncryptedPlanner('youtube')">YouTube</button>
  </div>
  <iframe id="plannerFrame"></iframe>
  <br>
  <button onclick="logout()">Logout</button>
</div>

<script>
// =============================
// Anti-Inspect & Security
// =============================
document.addEventListener('contextmenu', e => e.preventDefault());
document.onkeydown = e => {
  if (e.keyCode == 123) return false; // F12
  if (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) return false;
  if (e.ctrlKey && e.key.toUpperCase() === 'U') return false;
};

// =============================
// Login System
// =============================
const USER = "martinganteng";
const PASS = "martinterkece";
const EXP_MIN = 30;

function checkLogin(){
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  if(u===USER && p===PASS){
    localStorage.setItem("taka_session", Date.now() + EXP_MIN*60*1000);
    document.getElementById("loginBox").style.display="none";
    document.getElementById("dashboard").style.display="block";
  } else {
    document.getElementById("loginStatus").innerText="❌ Invalid login";
  }
}

function checkSession(){
  const t = localStorage.getItem("taka_session");
  if(!t || Date.now()>t){
    localStorage.removeItem("taka_session");
    document.getElementById("loginBox").style.display="block";
    document.getElementById("dashboard").style.display="none";
  } else {
    document.getElementById("loginBox").style.display="none";
    document.getElementById("dashboard").style.display="block";
  }
}
checkSession();

function logout(){
  localStorage.removeItem("taka_session");
  location.reload();
}

// =============================
// AES-GCM Decryption Runtime
// =============================
function b64ToBytes(b64){
  const bin = atob(b64.trim());
  const len = bin.length;
  const bytes = new Uint8Array(len);
  for(let i=0;i<len;i++) bytes[i]=bin.charCodeAt(i);
  return bytes;
}
async function importKeyFromPassword(password,salt){
  const enc = new TextEncoder();
  const keyMat = await crypto.subtle.importKey("raw",enc.encode(password),"PBKDF2",false,["deriveKey"]);
  return crypto.subtle.deriveKey(
    {name:"PBKDF2",salt,iterations:120000,hash:"SHA-256"},
    keyMat,{name:"AES-GCM",length:256},false,["decrypt"]);
}
async function decryptB64(b64){
  const buf = b64ToBytes(b64);
  const salt = buf.slice(0,16);
  const iv   = buf.slice(16,28);
  const data = buf.slice(28, buf.length-16);
  const tag  = buf.slice(buf.length-16);
  const ctTag = new Uint8Array(data.length+tag.length);
  ctTag.set(data,0); ctTag.set(tag,data.length);
  const key = await importKeyFromPassword("TAKAALLIANCE_2025",salt);
  const plain = await crypto.subtle.decrypt({name:"AES-GCM",iv},key,ctTag);
  return new TextDecoder().decode(new Uint8Array(plain));
}

// =============================
// Auto-detect base path
// =============================
async function loadEncryptedPlanner(name){
  let tryPaths = [
    `/assets/planners_encrypted/${name}.enc`,
    `/public/assets/planners_encrypted/${name}.enc`
  ];
  let found = null, b64 = null;

  for(let path of tryPaths){
    try {
      const res = await fetch(path);
      if(res.ok){
        b64 = await res.text();
        found = path;
        break;
      }
    } catch(e){}
  }

  if(!found){ alert("❌ File not found in any path."); return; }

  try {
    const html = await decryptB64(b64);
    const blob = new Blob([html], {type:"text/html"});
    const url = URL.createObjectURL(blob);
    const iframe = document.getElementById("plannerFrame");
    iframe.src = url;
  } catch(e){
    alert("❌ Decryption failed. Wrong key or corrupted file.");
  }
}

</script>
</body>
</html>
